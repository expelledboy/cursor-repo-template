# AgentOS v9 - Complete API Exposure via Just
set dotenv-load := true
set export := true
set shell := ["bash", "-cu"]

# Modular API organization
mod evidence "scripts/evidence"
mod tasks "scripts/tasks"
mod system "scripts/system"

# Default help
default:
  @echo "ğŸ¯ AgentOS v9 - Complete API Exposure"
  @echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
  @echo ""
  @echo "ğŸ“‹ Available APIs:"
  @echo "  just evidence     # Evidence collection and analysis"
  @echo "  just tasks        # Task management and workflows"
  @echo "  just system       # System health and API documentation"
  @echo ""
  @echo "ğŸ” Quick Commands:"
  @echo "  just assess       # Start self-determination assessment"
  @echo "  just health       # Basic system health check"
  @echo "  just api          # Complete API reference"
  @echo ""
  @echo "ğŸ“– Help: just --help [module]"

# Quick assessment workflow
assess:
  just evidence system
  just tasks assess
  just evidence alignment
  @echo ""
  @echo "ğŸ‰ Self-determination assessment initiated!"
  @echo "ğŸ“‹ Created assessment task + collected evidence"
  @echo "ğŸ¯ Next: just learn (add learning objectives)"

# Quick health check
health:
  #!/usr/bin/env bash
  echo "ğŸ¥ AgentOS System Health Check"
  echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"

  # Check core directories
  echo "ğŸ“ Directory Structure:"
  if [ -d "docs" ]; then
    DOC_COUNT=$(find docs -name "*.md" 2>/dev/null | wc -l)
    echo "  âœ… docs: ${DOC_COUNT} markdown files"
  else
    echo "  âŒ docs: directory missing"
  fi

  if [ -d "scripts" ]; then
    SCRIPT_COUNT=$(find scripts -name "*.py" 2>/dev/null | wc -l)
    echo "  âœ… scripts: ${SCRIPT_COUNT} Python files"
  else
    echo "  âŒ scripts: directory missing"
  fi

  if [ -d "src" ]; then
    SRC_COUNT=$(find src -name "*.py" 2>/dev/null | wc -l)
    echo "  âœ… src: ${SRC_COUNT} Python files"
  else
    echo "  âŒ src: directory missing"
  fi

  echo ""

  # Check core files
  echo "ğŸ“„ Core Files:"
  if [ -f "src/agentos.py" ]; then
    echo "  âœ… src/agentos.py: present"
  else
    echo "  âŒ src/agentos.py: missing"
  fi

  if [ -f "README.md" ]; then
    echo "  âœ… README.md: present"
  else
    echo "  âŒ README.md: missing"
  fi

  echo ""

  # Basic syntax check
  echo "ğŸ Python Syntax Check:"
  PYTHON_FILES=$(find . -name "*.py" -type f 2>/dev/null)
  TOTAL_PY=$(echo "$PYTHON_FILES" | wc -l)
  SYNTAX_ERRORS=0

  for py_file in $PYTHON_FILES; do
    if [ -f "$py_file" ]; then
      if ! python3 -m py_compile "$py_file" 2>/dev/null; then
        SYNTAX_ERRORS=$((SYNTAX_ERRORS + 1))
      fi
    fi
  done

  if [ $SYNTAX_ERRORS -eq 0 ]; then
    echo "  âœ… ${TOTAL_PY} Python files: no syntax errors"
  else
    echo "  âš ï¸  ${TOTAL_PY} Python files: ${SYNTAX_ERRORS} syntax errors found"
  fi

  echo ""
  echo "ğŸ¯ Health check complete!"

# Complete API reference
api:
  just system api

# Self-determination workflow
self-determine: assess
  @echo ""
  @echo "ğŸ”„ Self-determination workflow active"
  @echo "ğŸ“Š Evidence collected, assessment task created"
  @echo ""
  @echo "ğŸ”„ Self-determination workflow active"
  @echo "ğŸ“Š Evidence collected, task created"
  @echo "ğŸ¯ Continue with: just learn, just improve, just reflect"