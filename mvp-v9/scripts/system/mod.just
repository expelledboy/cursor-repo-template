# AgentOS System API - Health, Validation & Documentation
# @directive docs/reference/agentos/doe-framework.md

# Pure bash system health check (efficient, no Python overhead)
health:
  #!/usr/bin/env bash
  echo "ğŸ¥ AgentOS System Health Check"
  echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"

  # Check core directories (relative to current working directory)
  echo "ğŸ“ Directory Structure:"
  if [ -d "docs" ]; then
    DOC_COUNT=$(find docs -name "*.md" 2>/dev/null | wc -l)
    echo "  âœ… docs: ${DOC_COUNT} markdown files"
  else
    echo "  âŒ docs: directory missing"
  fi

  if [ -d "scripts" ]; then
    SCRIPT_COUNT=$(find scripts -name "*.py" 2>/dev/null | wc -l)
    echo "  âœ… scripts: ${SCRIPT_COUNT} Python files"
  else
    echo "  âŒ scripts: directory missing"
  fi

  if [ -d "src" ]; then
    SRC_COUNT=$(find src -name "*.py" 2>/dev/null | wc -l)
    echo "  âœ… src: ${SRC_COUNT} Python files"
  else
    echo "  âŒ src: directory missing"
  fi

  echo ""

  # Check core files
  echo "ğŸ“„ Core Files:"
  if [ -f "src/agentos.py" ]; then
    echo "  âœ… src/agentos.py: present"
  else
    echo "  âŒ src/agentos.py: missing"
  fi

  if [ -f "README.md" ]; then
    echo "  âœ… README.md: present"
  else
    echo "  âŒ README.md: missing"
  fi

  echo ""

  # Basic syntax check (pure bash)
  echo "ğŸ Python Syntax Check:"
  PYTHON_FILES=$(find . -name "*.py" -type f 2>/dev/null)
  TOTAL_PY=$(echo "$PYTHON_FILES" | wc -l)
  SYNTAX_ERRORS=0

  for py_file in $PYTHON_FILES; do
    if [ -f "$py_file" ]; then
      if ! python3 -m py_compile "$py_file" 2>/dev/null; then
        SYNTAX_ERRORS=$((SYNTAX_ERRORS + 1))
      fi
    fi
  done

  if [ $SYNTAX_ERRORS -eq 0 ]; then
    echo "  âœ… ${TOTAL_PY} Python files: no syntax errors"
  else
    echo "  âš ï¸  ${TOTAL_PY} Python files: ${SYNTAX_ERRORS} syntax errors found"
  fi

  echo ""
  echo "ğŸ¯ Health check complete!"

# Python-wrapped system validation
validate:
  @echo "ğŸ” Running complete system validation..."
  python3 scripts/validate.py

# API documentation (pure bash - no Python dependency)
api:
  #!/usr/bin/env bash
  echo "ğŸ“š AgentOS Complete API Reference"
  echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
  echo ""
  echo "ğŸ¯ QUICK WORKFLOWS:"
  echo "  just assess          # Start self-determination assessment"
  echo "  just self-determine  # Complete self-determination workflow"
  echo "  just health          # Basic system health check"
  echo ""
  echo "ğŸ” EVIDENCE API (just evidence):"
  echo "  just evidence system        # System structure evidence"
  echo "  just evidence alignment     # Docs-implementation alignment"
  echo "  just evidence gaps          # Gap detection evidence"
  echo "  just evidence hierarchy     # Authority hierarchy evidence"
  echo "  just evidence all           # Complete evidence suite"
  echo "  just evidence analyze-*     # Analysis guidance for each type"
  echo ""
  echo "ğŸ¯ TASK API (just tasks):"
  echo "  just tasks assess           # Start assessment workflow"
  echo "  just tasks learn            # Start learning workflow"
  echo "  just tasks improve          # Start improvement workflow"
  echo "  just tasks reflect          # Start reflection workflow"
  echo "  just tasks list             # Show active tasks"
  echo "  just tasks create NAME OBJ  # Create custom task"
  echo "  just tasks add-sub-objective # Advanced task management"
  echo "  just tasks record-*         # Progress diary entries"
  echo ""
  echo "ğŸ”§ SYSTEM API (just system):"
  echo "  just system validate        # Complete system validation"
  echo "  just system health          # Basic health check (pure bash)"
  echo "  just system api             # Show this API reference"
  echo ""
  echo "ğŸ”— INTEGRATION PATTERNS:"
  echo "  Assessment â†’ Learning â†’ Improvement:"
  echo "    just assess && just tasks learn && just tasks improve"
  echo ""
  echo "  Evidence + Tasks:"
  echo "    just evidence all && just tasks assess"
  echo ""
  echo "  Health + Validation:"
  echo "    just health && just system validate"
  echo ""
  echo "ğŸ“– HELP SYSTEM:"
  echo "  just --list                 # Show all available commands"
  echo "  just [module] --help        # Module-specific help"
  echo "  just [module] help          # Detailed module documentation"

# System statistics (pure bash)
stats:
  #!/usr/bin/env bash
  echo "ğŸ“Š AgentOS System Statistics"
  echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"

  # File counts
  TOTAL_MD=$(find docs -name "*.md" 2>/dev/null | wc -l)
  TOTAL_PY=$(find . -name "*.py" -type f 2>/dev/null | wc -l)
  TOTAL_FILES=$(find . -type f 2>/dev/null | wc -l)

  printf "Total files:     %6d\n" $TOTAL_FILES
  printf "Markdown docs:   %6d\n" $TOTAL_MD
  printf "Python scripts:  %6d\n" $TOTAL_PY

  # Directory sizes
  echo ""
  echo "ğŸ“ Directory Sizes:"
  if [ -d "docs" ]; then
    DOCS_SIZE=$(du -sh docs 2>/dev/null | cut -f1)
    echo "  docs:    $DOCS_SIZE"
  fi
  if [ -d "scripts" ]; then
    SCRIPTS_SIZE=$(du -sh scripts 2>/dev/null | cut -f1)
    echo "  scripts: $SCRIPTS_SIZE"
  fi
  if [ -d "src" ]; then
    SRC_SIZE=$(du -sh src 2>/dev/null | cut -f1)
    echo "  src:     $SRC_SIZE"
  fi

  # Git status (if applicable)
  if git rev-parse --git-dir > /dev/null 2>&1; then
    echo ""
    echo "ğŸ”„ Git Status:"
    CHANGES=$(git status --porcelain | wc -l)
    BRANCH=$(git branch --show-current)
    printf "  Branch:  %s\n" $BRANCH
    printf "  Changes: %d files\n" $CHANGES
  fi

# Help documentation
help:
  @echo "ğŸ“– AgentOS System API"
  @echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
  @echo ""
  @echo "ğŸ¥ HEALTH & VALIDATION:"
  @echo "  just system health          # Basic health check (pure bash)"
  @echo "  just system validate        # Complete system validation"
  @echo "  just system stats           # System statistics"
  @echo ""
  @echo "ğŸ“š DOCUMENTATION:"
  @echo "  just system api             # Complete API reference"
  @echo "  just system help            # This help documentation"
  @echo ""
  @echo "ğŸ”§ IMPLEMENTATION NOTES:"
  @echo "  health, stats, api: Pure bash (efficient, no dependencies)"
  @echo "  validate: Python-wrapped (complex validation logic)"
  @echo ""
  @echo "ğŸ”— INTEGRATION:"
  @echo "  Use with: just evidence all (comprehensive system assessment)"